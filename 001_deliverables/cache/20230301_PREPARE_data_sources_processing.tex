% Options for packages loaded elsewhere
\PassOptionsToPackage{unicode}{hyperref}
\PassOptionsToPackage{hyphens}{url}
%
\documentclass[
]{article}
\usepackage{amsmath,amssymb}
\usepackage{lmodern}
\usepackage{iftex}
\ifPDFTeX
  \usepackage[T1]{fontenc}
  \usepackage[utf8]{inputenc}
  \usepackage{textcomp} % provide euro and other symbols
\else % if luatex or xetex
  \usepackage{unicode-math}
  \defaultfontfeatures{Scale=MatchLowercase}
  \defaultfontfeatures[\rmfamily]{Ligatures=TeX,Scale=1}
  \setmainfont[]{Bahnschrift:style=Bold}
  \setmonofont[]{Bahnschrift:style=Condensed}
\fi
% Use upquote if available, for straight quotes in verbatim environments
\IfFileExists{upquote.sty}{\usepackage{upquote}}{}
\IfFileExists{microtype.sty}{% use microtype if available
  \usepackage[]{microtype}
  \UseMicrotypeSet[protrusion]{basicmath} % disable protrusion for tt fonts
}{}
\makeatletter
\@ifundefined{KOMAClassName}{% if non-KOMA class
  \IfFileExists{parskip.sty}{%
    \usepackage{parskip}
  }{% else
    \setlength{\parindent}{0pt}
    \setlength{\parskip}{6pt plus 2pt minus 1pt}}
}{% if KOMA class
  \KOMAoptions{parskip=half}}
\makeatother
\usepackage{xcolor}
\usepackage[margin=1in]{geometry}
\usepackage{color}
\usepackage{fancyvrb}
\newcommand{\VerbBar}{|}
\newcommand{\VERB}{\Verb[commandchars=\\\{\}]}
\DefineVerbatimEnvironment{Highlighting}{Verbatim}{commandchars=\\\{\}}
% fontsize=\small' for more characters per line
\usepackage{framed}
\definecolor{shadecolor}{RGB}{248,248,248}
\newenvironment{Shaded}{\begin{snugshade}}{\end{snugshade}}
\newcommand{\AlertTok}[1]{\textcolor[rgb]{0.94,0.16,0.16}{#1}}
\newcommand{\AnnotationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\AttributeTok}[1]{\textcolor[rgb]{0.77,0.63,0.00}{#1}}
\newcommand{\BaseNTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\BuiltInTok}[1]{#1}
\newcommand{\CharTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\CommentTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textit{#1}}}
\newcommand{\CommentVarTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\ConstantTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\ControlFlowTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{\textbf{#1}}}
\newcommand{\DataTypeTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{#1}}
\newcommand{\DecValTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\DocumentationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\ErrorTok}[1]{\textcolor[rgb]{0.64,0.00,0.00}{\textbf{#1}}}
\newcommand{\ExtensionTok}[1]{#1}
\newcommand{\FloatTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\FunctionTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\ImportTok}[1]{#1}
\newcommand{\InformationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\KeywordTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{\textbf{#1}}}
\newcommand{\NormalTok}[1]{#1}
\newcommand{\OperatorTok}[1]{\textcolor[rgb]{0.81,0.36,0.00}{\textbf{#1}}}
\newcommand{\OtherTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{#1}}
\newcommand{\PreprocessorTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textit{#1}}}
\newcommand{\RegionMarkerTok}[1]{#1}
\newcommand{\SpecialCharTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\SpecialStringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\StringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\VariableTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\VerbatimStringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\WarningTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\usepackage{graphicx}
\makeatletter
\def\maxwidth{\ifdim\Gin@nat@width>\linewidth\linewidth\else\Gin@nat@width\fi}
\def\maxheight{\ifdim\Gin@nat@height>\textheight\textheight\else\Gin@nat@height\fi}
\makeatother
% Scale images if necessary, so that they will not overflow the page
% margins by default, and it is still possible to overwrite the defaults
% using explicit options in \includegraphics[width, height, ...]{}
\setkeys{Gin}{width=\maxwidth,height=\maxheight,keepaspectratio}
% Set default figure placement to htbp
\makeatletter
\def\fps@figure{htbp}
\makeatother
\setlength{\emergencystretch}{3em} % prevent overfull lines
\providecommand{\tightlist}{%
  \setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}
\setcounter{secnumdepth}{-\maxdimen} % remove section numbering
\ifLuaTeX
  \usepackage{selnolig}  % disable illegal ligatures
\fi
\IfFileExists{bookmark.sty}{\usepackage{bookmark}}{\usepackage{hyperref}}
\IfFileExists{xurl.sty}{\usepackage{xurl}}{} % add URL line breaks if available
\urlstyle{same} % disable monospaced font for URLs
\hypersetup{
  pdftitle={Detailed data sources processing},
  pdfauthor={Michael-Philipp Stiebing},
  hidelinks,
  pdfcreator={LaTeX via pandoc}}

\title{Detailed data sources processing}
\author{Michael-Philipp Stiebing}
\date{2023-03-01}

\begin{document}
\maketitle

\begin{itemize}
\item
  Download source data from
  \textbf{\url{https://divvy-tripdata.s3.amazonaws.com/index.html}}
\item
  License for using the data from
  \textbf{\url{https://ride.divvybikes.com/data-license-agreement}}
\item
  Create project root folder - \textbf{/20221205-capstone\_datascience/}
  - as \textbf{../} in this document
\item
  Move raw, zipped data to
  \textbf{../099\_original\_raw\_data/001\_raw\_compressed/}
\item
  Unzip data into \textbf{../099\_original\_raw\_data/002\_raw\_csv/}
\item
  Copy data to \textbf{../002\_data/001\_csv/} as a working copy
\item
  Rename file \textbf{202209-divvy-publictripdata.csv} in
  \textbf{../002\_data/001\_csv/} to \textbf{202209-divvy-tripdata.csv}
  in order to match filename schema
\item
  Download quarterly formatted data from
  \textbf{\url{https://divvy-tripdata.s3.amazonaws.com/index.html}} to
  compare with monthly formatted data
\item
  Copy dataset \textbf{Divvy\_Trips\_2020\_Q1.csv} to
  \textbf{../099\_original\_raw\_data/002\_raw\_csv/} and working copy
  to \textbf{../002\_data/001\_csv/}
\item
  Comparing data in \textbf{Divvy\_Trips\_2020\_Q1.csv} to
  \textbf{202210-divvy-tripdata.csv} as to similarity.

  \begin{itemize}
  \tightlist
  \item
    Using OpenOffice Calc V 4.1.7 for comparison
  \item
    Column Names match
  \item
    The rideable\_type column contains more information in the
    \textbf{202210-divvy-tripdata.csv} as opposed to the
    \textbf{Divvy\_Trips\_2020\_Q1.csv}

    \begin{itemize}
    \tightlist
    \item
      In \textbf{Divvy\_Trips\_2020\_Q1.csv} only one type:
      dockable\_bike
    \item
      In \textbf{202210-divvy-tripdata.csv} either classic\_bike or
      electric\_bike
    \end{itemize}
  \item
    The columns start\_station\_id and end\_station\_id have different
    values

    \begin{itemize}
    \tightlist
    \item
      In \textbf{Divvy\_Trips\_2020\_Q1.csv} the values are numerical
    \item
      In \textbf{202210-divvy-tripdata.csv} some values are numerical,
      others are a mix of uppercase letters and numbers a few also
      include a dash `-'
    \end{itemize}
  \item
    The columns start\_lat, start\_lng, end\_lat, end\_lng are formatted
    differently

    \begin{itemize}
    \tightlist
    \item
      In \textbf{Divvy\_Trips\_2020\_Q1.csv} the values are truncated to
      4 decimal places
    \item
      In \textbf{202210-divvy-tripdata.csv} the values contain up to 10
      decimal places
    \end{itemize}
  \item
    Some records in \textbf{202210-divvy-tripdata.csv} do not contain
    start or end station data, leading me to believe it includes data
    from bikes that were rented not from a station, but standing around
    in the city.
  \end{itemize}
\item
  Checking \textbf{202110-divvy-tripdata.csv}, the oldest of the monthly
  datasets, to confirm that the differences persist
\item
  I will be using the monthly datasets for the analysis, because:

  \begin{itemize}
  \tightlist
  \item
    The data is more current
  \item
    It includes additional data as to the type of bike used
  \item
    The data that is missing (station names) or not formatted nicely
    (gps coordinates) doesn't seem to impact the analysis
  \end{itemize}
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(tidyverse)}
\FunctionTok{library}\NormalTok{(lubridate)}
\FunctionTok{library}\NormalTok{(ggplot2)}
\FunctionTok{library}\NormalTok{(readr)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{setwd}\NormalTok{(}\StringTok{"/home/mikiR/remote\_transfer/"}\NormalTok{)}
\NormalTok{X202110\_divvy\_tripdata }\OtherTok{\textless{}{-}} 
  \FunctionTok{read\_csv}\NormalTok{(}\StringTok{"./20221205{-}capstone\_datascience{-}01/002\_data/001\_csv/202110{-}divvy{-}tripdata.csv"}\NormalTok{)}
\NormalTok{X202111\_divvy\_tripdata }\OtherTok{\textless{}{-}} 
  \FunctionTok{read\_csv}\NormalTok{(}\StringTok{"./20221205{-}capstone\_datascience{-}01/002\_data/001\_csv/202111{-}divvy{-}tripdata.csv"}\NormalTok{)}
\NormalTok{X202112\_divvy\_tripdata }\OtherTok{\textless{}{-}} 
  \FunctionTok{read\_csv}\NormalTok{(}\StringTok{"./20221205{-}capstone\_datascience{-}01/002\_data/001\_csv/202112{-}divvy{-}tripdata.csv"}\NormalTok{)}
\NormalTok{X202201\_divvy\_tripdata }\OtherTok{\textless{}{-}} 
  \FunctionTok{read\_csv}\NormalTok{(}\StringTok{"./20221205{-}capstone\_datascience{-}01/002\_data/001\_csv/202201{-}divvy{-}tripdata.csv"}\NormalTok{)}
\NormalTok{X202202\_divvy\_tripdata }\OtherTok{\textless{}{-}} 
  \FunctionTok{read\_csv}\NormalTok{(}\StringTok{"./20221205{-}capstone\_datascience{-}01/002\_data/001\_csv/202202{-}divvy{-}tripdata.csv"}\NormalTok{)}
\NormalTok{X202203\_divvy\_tripdata }\OtherTok{\textless{}{-}} 
  \FunctionTok{read\_csv}\NormalTok{(}\StringTok{"./20221205{-}capstone\_datascience{-}01/002\_data/001\_csv/202203{-}divvy{-}tripdata.csv"}\NormalTok{)}
\NormalTok{X202204\_divvy\_tripdata }\OtherTok{\textless{}{-}} 
  \FunctionTok{read\_csv}\NormalTok{(}\StringTok{"./20221205{-}capstone\_datascience{-}01/002\_data/001\_csv/202204{-}divvy{-}tripdata.csv"}\NormalTok{)}
\NormalTok{X202205\_divvy\_tripdata }\OtherTok{\textless{}{-}} 
  \FunctionTok{read\_csv}\NormalTok{(}\StringTok{"./20221205{-}capstone\_datascience{-}01/002\_data/001\_csv/202205{-}divvy{-}tripdata.csv"}\NormalTok{)}
\NormalTok{X202206\_divvy\_tripdata }\OtherTok{\textless{}{-}} 
  \FunctionTok{read\_csv}\NormalTok{(}\StringTok{"./20221205{-}capstone\_datascience{-}01/002\_data/001\_csv/202206{-}divvy{-}tripdata.csv"}\NormalTok{)}
\NormalTok{X202207\_divvy\_tripdata }\OtherTok{\textless{}{-}} 
  \FunctionTok{read\_csv}\NormalTok{(}\StringTok{"./20221205{-}capstone\_datascience{-}01/002\_data/001\_csv/202207{-}divvy{-}tripdata.csv"}\NormalTok{)}
\NormalTok{X202208\_divvy\_tripdata }\OtherTok{\textless{}{-}} 
  \FunctionTok{read\_csv}\NormalTok{(}\StringTok{"./20221205{-}capstone\_datascience{-}01/002\_data/001\_csv/202208{-}divvy{-}tripdata.csv"}\NormalTok{)}
\NormalTok{X202209\_divvy\_tripdata }\OtherTok{\textless{}{-}} 
  \FunctionTok{read\_csv}\NormalTok{(}\StringTok{"./20221205{-}capstone\_datascience{-}01/002\_data/001\_csv/202209{-}divvy{-}tripdata.csv"}\NormalTok{)}
\NormalTok{X202210\_divvy\_tripdata }\OtherTok{\textless{}{-}} 
  \FunctionTok{read\_csv}\NormalTok{(}\StringTok{"./20221205{-}capstone\_datascience{-}01/002\_data/001\_csv/202210{-}divvy{-}tripdata.csv"}\NormalTok{)}

\NormalTok{all\_trips }\OtherTok{\textless{}{-}} \FunctionTok{bind\_rows}\NormalTok{(}
\NormalTok{                  X202110\_divvy\_tripdata, X202111\_divvy\_tripdata, X202112\_divvy\_tripdata, }
\NormalTok{                  X202201\_divvy\_tripdata, X202202\_divvy\_tripdata, X202203\_divvy\_tripdata, }
\NormalTok{                  X202204\_divvy\_tripdata, X202205\_divvy\_tripdata, X202206\_divvy\_tripdata, }
\NormalTok{                  X202207\_divvy\_tripdata, X202208\_divvy\_tripdata, X202209\_divvy\_tripdata, }
\NormalTok{                  X202210\_divvy\_tripdata)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{all\_trips}\SpecialCharTok{$}\NormalTok{date }\OtherTok{\textless{}{-}} \FunctionTok{as.Date}\NormalTok{(all\_trips}\SpecialCharTok{$}\NormalTok{started\_at)}
\NormalTok{all\_trips}\SpecialCharTok{$}\NormalTok{month }\OtherTok{\textless{}{-}} \FunctionTok{format}\NormalTok{(}\FunctionTok{as.Date}\NormalTok{(all\_trips}\SpecialCharTok{$}\NormalTok{date), }\StringTok{"\%m"}\NormalTok{)}
\NormalTok{all\_trips}\SpecialCharTok{$}\NormalTok{day }\OtherTok{\textless{}{-}} \FunctionTok{format}\NormalTok{(}\FunctionTok{as.Date}\NormalTok{(all\_trips}\SpecialCharTok{$}\NormalTok{date), }\StringTok{"\%d"}\NormalTok{)}
\NormalTok{all\_trips}\SpecialCharTok{$}\NormalTok{year }\OtherTok{\textless{}{-}} \FunctionTok{format}\NormalTok{(}\FunctionTok{as.Date}\NormalTok{(all\_trips}\SpecialCharTok{$}\NormalTok{date), }\StringTok{"\%Y"}\NormalTok{)}
\NormalTok{all\_trips}\SpecialCharTok{$}\NormalTok{day\_of\_week }\OtherTok{\textless{}{-}} \FunctionTok{format}\NormalTok{(}\FunctionTok{as.Date}\NormalTok{(all\_trips}\SpecialCharTok{$}\NormalTok{date), }\StringTok{"\%A"}\NormalTok{)}
\NormalTok{all\_trips}\SpecialCharTok{$}\NormalTok{ride\_length }\OtherTok{\textless{}{-}} \FunctionTok{difftime}\NormalTok{(all\_trips}\SpecialCharTok{$}\NormalTok{ended\_at,all\_trips}\SpecialCharTok{$}\NormalTok{started\_at)}

\NormalTok{all\_trips}\SpecialCharTok{$}\NormalTok{ride\_length }\OtherTok{\textless{}{-}} \FunctionTok{as.numeric}\NormalTok{(}\FunctionTok{as.character}\NormalTok{(all\_trips}\SpecialCharTok{$}\NormalTok{ride\_length))}
\end{Highlighting}
\end{Shaded}

\begin{itemize}
\tightlist
\item
  Remove bad data
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{all\_trips\_v2 }\OtherTok{\textless{}{-}}\NormalTok{ all\_trips[}\SpecialCharTok{!}\NormalTok{(all\_trips}\SpecialCharTok{$}\NormalTok{ride\_length}\SpecialCharTok{\textless{}}\DecValTok{0}\NormalTok{),]}
\end{Highlighting}
\end{Shaded}

\begin{itemize}
\tightlist
\item
  move bad data into a dataframe to doublecheck
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{all\_trips\_errors }\OtherTok{\textless{}{-}}\NormalTok{ all\_trips[(all\_trips}\SpecialCharTok{$}\NormalTok{ride\_length}\SpecialCharTok{\textless{}}\DecValTok{0}\NormalTok{),]}
\end{Highlighting}
\end{Shaded}

\begin{itemize}
\tightlist
\item
  Trying to calculate the distance between gps coordinates strart / end
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(geosphere) }
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{all\_trips\_v3 }\OtherTok{\textless{}{-}}\NormalTok{ all\_trips\_v2 }\SpecialCharTok{\%\textgreater{}\%} 
              \FunctionTok{mutate}\NormalTok{(}\AttributeTok{geodist =} \FunctionTok{distHaversine}\NormalTok{(}
                    \FunctionTok{cbind}\NormalTok{(all\_trips\_v2}\SpecialCharTok{$}\NormalTok{start\_lng,all\_trips\_v2}\SpecialCharTok{$}\NormalTok{start\_lat), }
                    \FunctionTok{cbind}\NormalTok{(all\_trips\_v2}\SpecialCharTok{$}\NormalTok{end\_lng,all\_trips\_v2}\SpecialCharTok{$}\NormalTok{end\_lat)))}
\end{Highlighting}
\end{Shaded}

\begin{itemize}
\tightlist
\item
  filter all trips with distance = 0 into a dataframe called
  round\_trips, the assumtion being that when the trip ends where it
  started
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{round\_trips }\OtherTok{=} \FunctionTok{filter}\NormalTok{(all\_trips\_v3,geodist }\SpecialCharTok{==} \DecValTok{0}\NormalTok{)}
\end{Highlighting}
\end{Shaded}


\end{document}
